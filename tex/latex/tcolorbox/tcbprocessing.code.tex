%% The LaTeX package tcolorbox - version 6.2.0pre2 (2023/10/27)
%% tcbprocessing.code.tex: Code for conditional processing
%%
%% -------------------------------------------------------------------------------------------
%% Copyright (c) 2006-2023 by Prof. Dr. Dr. Thomas F. Sturm <thomas dot sturm at unibw dot de>
%% -------------------------------------------------------------------------------------------
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `author-maintained'.
%%
%% This work consists of all files listed in README
%%
\tcb@set@library@version{6.2.0pre2}

\ExplSyntaxOn
\str_new:N \l__tcobox_proc_last_hash_str
\str_new:N \l__tcobox_proc_curr_hash_str

\cs_new_protected:Npn \__tcobox_read_mdfive:nn #1#2
  {
    \str_set:Ne \l__tcobox_proc_last_hash_str { \file_mdfive_hash:n {#1} }
    \file_if_exist_input:nF {#2}
      { \str_clear:N \l__tcobox_proc_last_hash_str }
  }

\cs_new_protected:Npn \__tcobox_write_mdfive:nn #1
  {
    \iow_open:Nn \g__tcobox_out_iow {#1}
    \iow_now:Ne \g__tcobox_out_iow
      {
        % safe and worthy?
        \token_to_str:N \ExplSyntaxOn
        \token_to_str:N \def \token_to_str:N \l__tcobox_proc_last_hash_str
          { \l__tcobox_proc_curr_hash_str }
        \token_to_str:N \ExplSyntaxOff
      }
    \iow_close:N \g__tcobox_out_iow
  }

\cs_new_protected:Npn \__tcobox_if_process_on:nnnTF #1#2#3
  {
    \__tcobox_read_mdfive:nn {#1} {#2}
    \str_if_eq:NNF \l__tcobox_proc_last_hash_str \l__tcobox_proc_curr_hash_str
      { \__tcobox_write_mdfive:nn {#2} }
    \use_i:nn
  }

% define it by \prg_new_protected_conditional:Npnn?
\cs_new_protected:Npn \__tcobox_if_process_conditional:nnnTF #1#2#3
  {
    \__tcobox_read_mdfive:nn {#1} {#2}
    \str_if_eq:NNTF \l__tcobox_proc_last_hash_str \l__tcobox_proc_curr_hash_str
      {
        \file_if_exist:nTF {#3}
          {
            \str_if_eq:eeTF { \file_timestamp:n {#2} }{ \file_timestamp:n {#3} }
              { \use_ii:nn }
              { \use_i:nn }
          }
          { \use_i:nn }
      }
      {
        \__tcobox_write_mdfive:nn {#2}
        \use_i:nn
      }
  }

\cs_new_protected:Npn \__tcobox_if_process_off:nnnTF #1#2#3
  {
    \__tcobox_read_mdfive:nn {#1} {#2}
    \str_if_eq:NNF \l__tcobox_proc_last_hash_str \l__tcobox_proc_curr_hash_str
      { \__tcobox_write_mdfive:nn {#2} }
    \use_ii:nn
  }

\cs_new_protected:Npn \__tcobox_if_file_process:nnnnTF #1
  {
    \int_case:nn {#1}
      {
        {0} { \__tcobox_if_process_on:nnnTF }
        {1} { \__tcobox_if_process_conditional:nnnTF }
        {2} { \__tcobox_if_process_off:nnnTF }
      }
  }
\cs_gset_eq:NN \tcbiffileprocess \__tcobox_if_file_process:nnnnTF

\ExplSyntaxOff
